# Git History Deep Analyzer

A comprehensive enterprise-grade application for analyzing Git repository history with staff correlation, featuring a modern **React + FastAPI** architecture, interactive dashboards, AI-powered analytics, and **ultra-fast pre-calculated metrics** (20-70x faster).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GIT HISTORY DEEP ANALYZER                                 â”‚
â”‚                Version 3.3 (Performance-Optimized Enterprise Edition)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Extract â†’ Analyze â†’ Map â†’ Visualize â†’ Export â†’ Report                      â”‚
â”‚  NEW: 20-70x Faster Queries | 6 Pre-Calc Metric Tables | Enhanced SQL Tool  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Git    â”‚  â”‚   PRs    â”‚  â”‚  Staff   â”‚  â”‚ Author   â”‚  â”‚  React   â”‚    â”‚
â”‚  â”‚ Commits  â”‚â†’ â”‚Approvals â”‚â†’ â”‚ Details  â”‚â†’ â”‚ Mapping  â”‚â†’ â”‚Dashboard â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â†“             â†“             â†“             â†“             â†“             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    SQLite / MySQL / PostgreSQL                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â†“                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              FastAPI Backend + React Frontend                      â”‚    â”‚
â”‚  â”‚  10+ Pages | Real-time Filters | Staff Analytics | Productivity   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Table of Contents

- [What's New in v3.1](#whats-new-in-v31)
- [Architecture Overview](#architecture-overview)
- [Features](#features)
- [Technology Stack](#technology-stack)
- [Installation](#installation)
- [Quick Start](#quick-start)
- [Dashboard Pages](#dashboard-pages)
- [API Endpoints](#api-endpoints)
- [Database Schema](#database-schema)
- [Staff Integration](#staff-integration)
- [Productivity Analytics](#productivity-analytics)
- [CLI Utilities](#cli-utilities)
- [Configuration](#configuration)
- [Usage Examples](#usage-examples)
- [Troubleshooting](#troubleshooting)

---

## What's New in v3.3 (MAJOR PERFORMANCE UPDATE)

### âš¡ Ultra-Fast Performance Optimization (20-70x Faster!)

**The Problem**: Real-time database queries were slow (2-4 seconds per page)
**The Solution**: Pre-calculated metric tables updated during data extraction

**Performance Gains**:
- Staff Details: **3.2s â†’ 70ms** (45x faster)
- Repository List: **2.0s â†’ 50ms** (40x faster)
- Team Dashboard: **3.5s â†’ 40ms** (87x faster)
- Daily Trends: **4.0s â†’ 65ms** (61x faster)

### ğŸ“Š Six New Metric Tables

1. **commit_metrics** - Daily commit aggregations by author/repo/branch
2. **pr_metrics** - Daily PR aggregations with merge time tracking
3. **repository_metrics** - Repository-level statistics and health
4. **author_metrics** - Author productivity before staff mapping
5. **team_metrics** - Team/platform/tech unit aggregations
6. **daily_metrics** - Daily org-wide trends with moving averages

### ğŸ› ï¸ New CLI Command: `calculate-metrics`

```bash
# Calculate all metrics (recommended after extract)
python -m cli calculate-metrics --all

# Calculate specific metrics
python -m cli calculate-metrics --staff --teams --repositories

# Force recalculation
python -m cli calculate-metrics --all --force
```

### ğŸš€ New Optimized API Endpoints

- `/api/repository-metrics/` - Repository statistics (40x faster)
- `/api/team-metrics/` - Team aggregations (87x faster)
- `/api/team-metrics/by-tech-unit` - Tech unit metrics
- `/api/team-metrics/by-platform` - Platform metrics

### ğŸ“ Enhanced SQL Executor

- 360-line comprehensive schema documentation
- Detailed field descriptions and relationships
- Common query patterns and examples
- Query optimization tips (DO/DON'T)
- AI-powered query generation improved

### ğŸ“š Complete Documentation Suite

- [SETUP_GUIDE.md](SETUP_GUIDE.md) - Step-by-step setup instructions
- [COMPREHENSIVE_OPTIMIZATION_COMPLETE.md](COMPREHENSIVE_OPTIMIZATION_COMPLETE.md) - Full optimization details
- Migration script: `migrate_all_metrics_tables.py`

---

## What's New in v3.2

### ğŸš€ Enhanced Commit Tracking
- **Character-level metrics**: Track characters added/deleted per commit for fine-grained analysis
- **File type tracking**: Identify which programming languages and file types are being modified
- **Technology insights**: Automatic detection of file extensions (py, js, md, css, etc.)

### ğŸ“Š Improved Dashboard Features
- **Quarterly granularity**: New default time period for better quarterly reporting
- **Combined metrics view**: Grouped bar charts showing commits, lines, and files by period
- **File type analytics**: Visualize technology stack usage and language distribution
- **Collapsible filters**: Cleaner UI with expandable filter sections

### ğŸ› ï¸ CLI Reorganization
- **Modular structure**: All CLI tools organized in `cli/` package
- **Utility scripts**: New tools for database management and data verification
- **Migration support**: Seamless upgrade path for existing installations

### ğŸ“ˆ Analytics Enhancements
- **Character churn analysis**: Identify high-activity areas and refactoring patterns
- **Language distribution**: Track which file types receive most commits
- **Enhanced API**: All endpoints include new character and file type fields

### ğŸ”§ Developer Tools
- `check_database.py` - Verify database status and field population
- `view_commit_samples.py` - Inspect commit data with new fields
- `update_existing_commits.py` - Backfill existing data with new metrics
- `migrate_add_commit_details.py` - Database migration utility

---

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MODERN ARCHITECTURE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  React Frontend â”‚        â”‚  FastAPI Backend â”‚                  â”‚
â”‚  â”‚   (Vite + Ant)  â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚   (Python 3.8+)  â”‚                  â”‚
â”‚  â”‚                 â”‚  REST  â”‚                  â”‚                  â”‚
â”‚  â”‚ â€¢ 10+ Pages     â”‚  API   â”‚ â€¢ 15+ Endpoints  â”‚                  â”‚
â”‚  â”‚ â€¢ Charts        â”‚        â”‚ â€¢ SQLAlchemy ORM â”‚                  â”‚
â”‚  â”‚ â€¢ Real-time     â”‚        â”‚ â€¢ Pydantic       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                          â”‚                             â”‚
â”‚           â†“                          â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚            Database Layer                  â”‚                   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                   â”‚
â”‚  â”‚  â”‚   SQLite     â”‚   â”‚ MySQL/PGSQL  â”‚      â”‚                   â”‚
â”‚  â”‚  â”‚ (Development)â”‚   â”‚ (Production) â”‚      â”‚                   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                   â”‚
â”‚  â”‚                                             â”‚                   â”‚
â”‚  â”‚  â€¢ 6 Core Tables                           â”‚                   â”‚
â”‚  â”‚  â€¢ Staff Integration                       â”‚                   â”‚
â”‚  â”‚  â€¢ Author Mapping                          â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Project Structure

```
deephistorydev/
â”œâ”€â”€ cli/                    # CLI Package (Python modules)
â”‚   â”œâ”€â”€ __init__.py        # Package initialization
â”‚   â”œâ”€â”€ __main__.py        # CLI entry point
â”‚   â”œâ”€â”€ cli.py             # Main CLI interface
â”‚   â”œâ”€â”€ config.py          # Configuration management
â”‚   â”œâ”€â”€ models.py          # Database models
â”‚   â”œâ”€â”€ git_analyzer.py    # Git analysis logic
â”‚   â”œâ”€â”€ bitbucket_api.py   # Bitbucket integration
â”‚   â”œâ”€â”€ dashboard.py       # Legacy Streamlit dashboard
â”‚   â”œâ”€â”€ start_backend.py   # Backend server starter
â”‚   â”œâ”€â”€ requirements.txt   # Python dependencies
â”‚   â””â”€â”€ README.md          # CLI documentation
â”‚
â”œâ”€â”€ backend/               # FastAPI Backend
â”‚   â”œâ”€â”€ main.py           # FastAPI application
â”‚   â””â”€â”€ routers/          # API route handlers
â”‚       â”œâ”€â”€ overview.py
â”‚       â”œâ”€â”€ commits.py
â”‚       â”œâ”€â”€ pull_requests.py
â”‚       â”œâ”€â”€ staff.py
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ frontend/             # React Frontend (Vite)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/       # Dashboard pages
â”‚   â”‚   â”œâ”€â”€ components/  # React components
â”‚   â”‚   â””â”€â”€ App.jsx      # Main application
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js
â”‚
â”œâ”€â”€ .env                  # Environment configuration
â”œâ”€â”€ .env.example          # Environment template
â””â”€â”€ README.md             # This file
```

---

## Features

### ğŸ¨ Modern React Frontend

#### Interactive Dashboard Pages (10+)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DASHBOARD PAGES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. Overview              â†’ Quick metrics & summary         â”‚
â”‚  2. Staff Analytics â­    â†’ Grouped by staff with filters   â”‚
â”‚  3. Commits View          â†’ Detailed commit history         â”‚
â”‚  4. Pull Requests View    â†’ PR tracking with filters        â”‚
â”‚  5. Top Commits           â†’ Largest code changes            â”‚
â”‚  6. Top Approvers         â†’ Most active reviewers           â”‚
â”‚  7. Staff Productivity ğŸ†• â†’ Individual performance metrics  â”‚
â”‚  8. Author Mapping â­     â†’ Link authors to staff           â”‚
â”‚     â€¢ Auto-match by email                                   â”‚
â”‚     â€¢ Bulk operations with smart suggestions                â”‚
â”‚     â€¢ Reverse mapping (staff â†’ author)                      â”‚
â”‚  9. Table Viewer          â†’ Browse all database tables      â”‚
â”‚ 10. SQL Executor          â†’ Custom queries + AI generation  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸš€ FastAPI Backend

**RESTful API with:**
- 15+ specialized endpoints
- Automatic OpenAPI documentation
- Fast async operations
- SQLAlchemy ORM
- Pydantic validation
- CORS support

### ğŸ“Š Staff Productivity Analytics (NEW)

**Comprehensive developer assessment:**
- âœ… **Time Granularity**: Daily | Weekly | Monthly | **Quarterly** (default)
- âœ… **Metrics**: Commits, Lines changed, PRs, Repos touched, Files changed
- âœ… **Enhanced Commit Tracking** ğŸ†•:
  - **Character counts**: Added/deleted characters per commit
  - **File types**: Languages/extensions modified (py, js, md, etc.)
  - **Technology insights**: Track which file types developers work with
- âœ… **Charts**:
  - Commits over time (line chart)
  - Lines changed (stacked column)
  - Combined metrics view (grouped bars by file type)
  - PR activity trend
  - Repository breakdown
  - Calendar heatmap (GitHub-style)
- âœ… **Filters**: Staff name, date range, repository
- âœ… **Export**: CSV for all charts
- âœ… **Staff-based grouping**: All Git identities merged per staff

### ğŸ”— Author-Staff Mapping

**Intelligent correlation system:**
- âœ… Auto-match by email with progress tracking
- âœ… Multi-select bulk operations
- âœ… Smart suggestions with similarity algorithm
- âœ… Reverse mapping (staff without mappings)
- âœ… Inactive staff exclusion
- âœ… Visual progress indicators

### ğŸ“ˆ Advanced Analytics

**Staff Analytics Features:**
- âœ… Grouped by staff_name/bank_id (all Git identities merged)
- âœ… Filters: Rank, Manager, Location, Staff Type
- âœ… "All" option in every filter dropdown
- âœ… Shows only mapped, active staff
- âœ… Real-time metric calculations
- âœ… CSV export for all data

---

## Technology Stack

### Frontend
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React 18            â”‚ Modern component-based UI             â”‚
â”‚ Vite 5              â”‚ Lightning-fast build tool             â”‚
â”‚ Ant Design 5        â”‚ Enterprise UI components              â”‚
â”‚ Ant Design Charts   â”‚ G2Plot visualizations                 â”‚
â”‚ React Router 6      â”‚ Client-side routing                   â”‚
â”‚ Axios               â”‚ HTTP client                           â”‚
â”‚ Day.js              â”‚ Date manipulation                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Backend
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI 0.104+      â”‚ Modern async web framework            â”‚
â”‚ Python 3.8+         â”‚ Core language                         â”‚
â”‚ SQLAlchemy 2.0+     â”‚ ORM with async support                â”‚
â”‚ Pydantic 2.0+       â”‚ Data validation                       â”‚
â”‚ Uvicorn             â”‚ ASGI server                           â”‚
â”‚ GitPython 3.1+      â”‚ Git repository analysis               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SQLite              â”‚ Development (default)                 â”‚
â”‚ MySQL/MariaDB       â”‚ Production option                     â”‚
â”‚ PostgreSQL          â”‚ Production option                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Installation

> **ğŸ“˜ Complete Setup Guide Available!**
> For detailed step-by-step instructions, see [SETUP_GUIDE.md](SETUP_GUIDE.md)

### Prerequisites

- **Python** 3.8 or higher
- **Node.js** 16+ and npm
- **Git** installed on your system
- **Database** (SQLite included, MySQL/PostgreSQL optional)

### Backend Setup

```bash
# 1. Install Python dependencies
pip install -r cli/requirements.txt

# 2. Create environment configuration
cp .env.example .env

# 3. Edit .env with your settings
nano .env
```

### Frontend Setup

```bash
# Navigate to frontend directory
cd frontend

# Install dependencies
npm install

# Build for production (optional)
npm run build
```

---

## Quick Start

### Complete Workflow (v3.4 - Updated)

```bash
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    QUICK START GUIDE                         â”‚
â”‚              âš¡ With Performance Optimization                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Step 1: Import Staff Details (FIRST!)                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚  $ python -m cli import-staff staff_data.xlsx               â”‚
â”‚  â†’ Populates staff_details table                           â”‚
â”‚  â†’ Required for author mapping                              â”‚
â”‚                                                              â”‚
â”‚  Step 2: Extract Git History                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚
â”‚  $ python -m cli extract repositories.csv                   â”‚
â”‚  â†’ Extracts commits, PRs, approvals                        â”‚
â”‚  â†’ Creates author-to-staff mappings                         â”‚
â”‚  â†’ Auto-calculates staff_metrics âš¡                        â”‚
â”‚                                                              â”‚
â”‚  Step 3: Calculate All Metrics (Optional)                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚  $ python -m cli calculate-metrics --all                    â”‚
â”‚  â†’ Populates 7 metric tables for 20-70x faster queries    â”‚
â”‚  â†’ Run after extract or when data changes                   â”‚
â”‚  â†’ Use --force to recalculate existing metrics              â”‚
â”‚                                                              â”‚
â”‚  Step 4: Start Backend Server                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚
â”‚  $ python -m uvicorn backend.main:app --reload --port 8000  â”‚
â”‚  â†’ Running on http://localhost:8000                        â”‚
â”‚  â†’ API docs: http://localhost:8000/docs                    â”‚
â”‚                                                              â”‚
â”‚  Step 5: Start Frontend (New Terminal)                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚  $ cd frontend                                              â”‚
â”‚  $ npm run dev                                              â”‚
â”‚  â†’ Running on http://localhost:3000                        â”‚
â”‚  â†’ Optimized with pre-calculated metrics âš¡                â”‚
â”‚                                                              â”‚
â”‚  Step 6: Verify & Explore                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚  â†’ Open http://localhost:3000                              â”‚
â”‚  â†’ Check "Table Viewer" - all 13 tables                    â”‚
â”‚  â†’ Open "Staff Details" - loads in <1 second! âš¡          â”‚
â”‚  â†’ Use "Author-Staff Mapping" if needed                     â”‚
â”‚  â†’ Explore dashboards and analytics                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quick Commands Reference

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DATA PREPARATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. Import staff data (Excel/CSV)
python -m cli import-staff path/to/staff_data.xlsx

# 2. Extract git repositories
python -m cli extract path/to/repositories.csv

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# METRICS CALCULATION (20-70x Performance Boost!)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Calculate all metric tables
python -m cli calculate-metrics --all

# Calculate specific metrics
python -m cli calculate-metrics --staff              # Staff productivity
python -m cli calculate-metrics --repositories       # Repository stats
python -m cli calculate-metrics --teams              # Team aggregations
python -m cli calculate-metrics --daily              # Daily trends

# Force recalculation (ignore timestamps)
python -m cli calculate-metrics --all --force

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# RUN SERVERS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Backend (Terminal 1)
python -m uvicorn backend.main:app --reload --port 8000

# Frontend (Terminal 2)
cd frontend
npm run dev

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# VERIFICATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Check table counts
python -c "from cli.config import Config; from cli.models import get_engine, get_session, StaffMetrics, CommitMetrics; config = Config(); engine = get_engine(config.get_db_config()); session = get_session(engine); print(f'staff_metrics: {session.query(StaffMetrics).count()}'); print(f'commit_metrics: {session.query(CommitMetrics).count()}')"

# Verify backend API
curl http://localhost:8000/api/tables/info

# Open dashboards
open http://localhost:3000
```

### Development Mode

```bash
# Terminal 1 - Backend
python cli/start_backend.py

# Terminal 2 - Frontend
cd frontend
npm run dev
```

### Production Mode

```bash
# Build frontend
cd frontend
npm run build

# Start backend (serves built frontend)
cd ..
python start_backend.py
```

---

## Dashboard Pages

### 1. Overview
**Quick metrics and repository summary**
- Total commits, authors, PRs, repositories
- Top contributors chart
- Recent activity

### 2. Staff Analytics â­ ENHANCED
**Comprehensive staff-based analytics**
- **Grouping**: All data grouped by staff_name/bank_id
- **Filters**: Rank, Manager, Location, Staff Type, Date Range
- **"All" option**: Every filter has "All" selection
- **Only Mapped Staff**: Shows only active, mapped staff members
- **Charts**: Top 10 staff by code changes
- **Export**: CSV download

### 3. Commits View
**Detailed commit history with enhanced tracking**
- Searchable and filterable table
- **Basic fields**: Author, date, message, lines changed
- **Enhanced fields** ğŸ†•: Character counts, file types
- Repository and branch filters
- Pagination and sorting
- Export to CSV

### 4. Pull Requests View
**PR tracking and analysis**
- PR status, author, dates
- Approval counts
- Merge information
- Filter by repository, author, state

### 5. Top Commits
**Largest code changes**
- Sorted by lines changed (added + deleted)
- Grouped column chart
- Top 20 commits
- Filter by date range

### 6. Top Approvers
**Most active PR reviewers**
- Horizontal bar chart
- Approval counts with medals (ğŸ¥‡ğŸ¥ˆğŸ¥‰)
- Top 20 approvers

### 7. Staff Productivity ğŸ†• NEW
**Individual developer performance**
- **Staff Selection**: Required - searchable dropdown
- **Time Granularity**: Daily | Weekly | Monthly | **Quarterly** (default)
- **Date Range**: Optional filter
- **Summary Stats**: 6 key metrics including character-level changes
- **Charts (5 tabs)**:
  1. Commits Over Time (line)
  2. Lines Changed (stacked column)
  3. Files Changed (area)
  4. Repos Touched (column)
  5. PR Activity (line)
- **Repository Breakdown**: Commits per repo
- **Calendar Heatmap**: GitHub-style daily commits (daily view)
- **CSV Export**: For all charts
- **Staff-Based**: All Git identities aggregated by bank_id
- **Enhanced Tracking** ğŸ†•: Character counts and file type analysis per commit

### 8. Author-Staff Mapping â­ ENHANCED
**Three-tab mapping interface**

**Tab 1: Create Mapping**
- Select unmapped author
- Select staff member (active only)
- Add optional notes
- Save mapping

**Tab 2: View Mappings**
- All existing mappings table
- Delete functionality
- CSV export
- Statistics

**Tab 3: Bulk Operations**
- **Auto-Match by Email**: Progress tracking
- **Multi-Select Bulk Mapping**:
  - Checkbox list of unmapped authors
  - Smart suggestions with similarity scores
  - Color-coded confidence (green/orange/gray)
  - Select all / Clear selection
  - Progress tracking
- **Reverse Mapping**: Staff â†’ Author
  - Shows unmapped staff members
  - Two-step mapping process
  - Clear visual workflow

### 9. Table Viewer
**Browse all database tables**
- Table selector
- Dynamic columns
- Row count display
- CSV export

### 10. SQL Executor
**Custom query execution**
- SQL editor
- Sample queries
- Results table
- CSV export

---

## API Endpoints

### Authors
```
GET  /api/authors/statistics              - Staff-based analytics with filters
GET  /api/authors/top-contributors        - Top contributors by metric
GET  /api/authors/filter-options          - Get filter dropdown values
GET  /api/authors/productivity/{bank_id}  - Individual staff productivity ğŸ†•
```

### Commits
```
GET  /api/commits/                        - List all commits
GET  /api/commits/top-by-lines            - Top commits by lines changed
```

### Pull Requests
```
GET  /api/pull-requests/                  - List all PRs
GET  /api/pull-requests/top-approvers     - Top PR approvers
```

### Staff
```
GET  /api/staff/                          - List active staff
GET  /api/staff/unmapped                  - List unmapped staff ğŸ†•
```

### Mappings
```
GET    /api/mappings/                     - List all mappings
POST   /api/mappings/                     - Create new mapping
DELETE /api/mappings/{author_name}        - Delete mapping
GET    /api/mappings/unmapped-authors     - List unmapped authors
```

### Overview
```
GET  /api/overview/stats                  - Dashboard overview statistics
```

### Tables
```
GET  /api/tables/info                     - List all tables
GET  /api/tables/{table_name}/data        - Get table data
```

---

## Database Schema

### Core Tables

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  repositories   â”‚         â”‚    commits       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ id (PK)          â”‚
â”‚ project_key     â”‚    1:N  â”‚ repository_id(FK)â”‚
â”‚ slug_name       â”‚         â”‚ commit_hash      â”‚
â”‚ clone_url       â”‚         â”‚ author_name      â”‚
â”‚ created_at      â”‚         â”‚ author_email     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ commit_date      â”‚
                            â”‚ lines_added      â”‚
                            â”‚ lines_deleted    â”‚
                            â”‚ files_changed    â”‚
                            â”‚ chars_added  ğŸ†•  â”‚
                            â”‚ chars_deletedğŸ†•  â”‚
                            â”‚ file_types   ğŸ†•  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pull_requests   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚
â”‚ repository_id(FK)â”‚
â”‚ pr_number       â”‚
â”‚ title           â”‚
â”‚ author_name     â”‚
â”‚ created_date    â”‚
â”‚ merged_date     â”‚
â”‚ state           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pr_approvals   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚
â”‚pull_request_id  â”‚
â”‚ approver_name   â”‚
â”‚ approver_email  â”‚
â”‚ approval_date   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ staff_details   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚
â”‚ bank_id_1       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ staff_id        â”‚         â”‚
â”‚ staff_name      â”‚         â”‚
â”‚ email_address   â”‚         â”‚
â”‚ rank            â”‚         â”‚
â”‚ work_location   â”‚         â”‚
â”‚ ... (71 fields) â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                            â”‚
                         1:Nâ”‚
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ author_staff_mapping    â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ id (PK)                 â”‚
              â”‚ author_name (UNIQUE)    â”‚
              â”‚ author_email            â”‚
              â”‚ bank_id_1 (FK)          â”‚
              â”‚ staff_id                â”‚
              â”‚ staff_name              â”‚
              â”‚ mapped_date             â”‚
              â”‚ notes                   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Enhanced Commit Tracking ğŸ†•

**New fields added to commits table for deeper insights:**

| Field | Type | Description | Use Case |
|-------|------|-------------|----------|
| `chars_added` | INTEGER | Characters added in commit | Fine-grained productivity metrics |
| `chars_deleted` | INTEGER | Characters deleted in commit | Code churn analysis |
| `file_types` | TEXT | Comma-separated extensions | Technology stack insights |

**Benefits:**
- **Language Distribution**: Track which programming languages are most active
- **Technology Insights**: Identify which file types developers work with (py, js, md, etc.)
- **Character-Level Metrics**: More granular productivity measurements beyond lines
- **Code Quality Analysis**: High character churn might indicate refactoring

**Example Data:**
```json
{
  "commit_hash": "7fd1a60b01f9",
  "lines_added": 26,
  "lines_deleted": 0,
  "chars_added": 1005,
  "chars_deleted": 0,
  "file_types": "css,md"
}
```

**Migration:**
```bash
# For existing databases, run migration to add new columns
python cli/migrate_add_commit_details.py

# Update existing commits with new data
python cli/update_existing_commits.py
```

---

## Staff Integration

### Key Features

**1. Inactive Staff Exclusion**
- Automatically filters out staff with `staff_status = 'Inactive'`
- Applies to:
  - Author mapping dropdowns
  - Staff analytics calculations
  - Filter options
  - Auto-match operations
- Existing mappings to inactive staff are preserved (historical data integrity)

**2. Staff-Based Grouping**
- All analytics grouped by `bank_id_1` (not author_name)
- Multiple Git identities per staff member are merged
- Example: john@work.com + john@personal.com = 1 staff entry

**3. Mapping Intelligence**
- **Auto-Match**: Matches by email address
- **Smart Suggestions**: Name similarity algorithm (Levenshtein-like)
- **Confidence Levels**:
  - Green (>70%): High confidence
  - Orange (50-70%): Medium confidence
  - Gray (<50%): Low confidence
- **Reverse Mapping**: Find authors for unmapped staff

---

## Productivity Analytics

### Staff Productivity Endpoint

**Endpoint**: `GET /api/authors/productivity/{bank_id}`

**Parameters**:
- `bank_id` (path): Staff bank ID (required)
- `granularity` (query): daily | weekly | monthly | **quarterly** (default) | yearly
- `start_date` (query): YYYY-MM-DD
- `end_date` (query): YYYY-MM-DD
- `repository_id` (query): Filter by repository

**Response Structure**:
```json
{
  "staff": {
    "bank_id": "EMP001",
    "name": "John Smith",
    "email": "john@company.com",
    "rank": "Senior Developer",
    "location": "New York",
    "tech_unit": "Platform",
    "staff_type": "Permanent"
  },
  "granularity": "monthly",
  "timeseries": {
    "commits": [
      {
        "period": "2024-01",
        "commits": 45,
        "lines_added": 2500,
        "lines_deleted": 1200,
        "files_changed": 120,
        "repos_touched": 3
      }
    ],
    "prs": [
      {
        "period": "2024-01",
        "prs_opened": 8
      }
    ]
  },
  "repository_breakdown": [...],
  "calendar_heatmap": [...],
  "summary": {
    "total_commits": 450,
    "date_range": {...}
  }
}
```

### How It Works

1. **Get all author mappings** for the staff member
2. **Aggregate data** from all mapped Git identities
3. **Group by time period** based on granularity
4. **Calculate metrics**:
   - Commits per period
   - Lines added/deleted per period
   - Files changed per period
   - Repos touched per period
   - PRs opened per period
5. **Generate breakdowns**:
   - Repository distribution
   - Calendar heatmap (daily only)

---

## Configuration

### Environment Variables (.env)

```ini
# Database Configuration
DB_TYPE=sqlite                    # or mysql, postgresql
SQLITE_DB_PATH=git_history.db

# MySQL/MariaDB (if using)
MARIADB_HOST=localhost
MARIADB_PORT=3306
MARIADB_USER=root
MARIADB_PASSWORD=your_password
MARIADB_DATABASE=git_history

# Git Credentials
GIT_USERNAME=your_git_username
GIT_PASSWORD=your_token

# Bitbucket API (Optional)
BITBUCKET_URL=https://bitbucket.company.com
BITBUCKET_USERNAME=your_username
BITBUCKET_APP_PASSWORD=your_app_password

# Clone Directory
CLONE_DIR=./repositories
```

### Frontend Configuration (frontend/.env)

```ini
# API Base URL
VITE_API_BASE_URL=http://localhost:8000
```

---

## Usage Examples

### Example 1: Basic Analysis Workflow

```bash
# 1. Extract Git data (with enhanced tracking)
python -m cli extract repositories.csv

# 2. Import staff data
python -m cli import-staff staff.xlsx

# 3. (Optional) Migrate existing database
python cli/migrate_add_commit_details.py

# 4. (Optional) Update existing commits with new fields
python cli/update_existing_commits.py

# 5. Start servers
python cli/start_backend.py      # Terminal 1
cd frontend && npm run dev        # Terminal 2

# 6. Open browser
# â†’ http://localhost:5173
# â†’ Navigate to "Author-Staff Mapping"
# â†’ Click "Auto-Match by Email"
# â†’ Map remaining authors
```

### Example 2: Productivity Assessment

```bash
# After data extraction and mapping:

# 1. Go to "Staff Productivity" page
# 2. Select staff member: "John Smith"
# 3. Choose granularity: "Quarterly" (default)
# 4. Set date range: Last year
# 5. View enhanced metrics:
#    - Commits trend over time
#    - Lines changed (stacked view)
#    - Character-level changes
#    - File types modified (technology stack)
#    - Repository distribution
#    - Calendar heatmap
# 6. Export CSV for reporting
```

### Example 3: Team Analytics

```bash
# In "Staff Analytics" page:

# 1. Filter by:
#    - Rank: "Senior Developer"
#    - Location: "New York"
#    - Date Range: Q4 2024
# 2. View aggregated team metrics
# 3. Export CSV
# 4. Analyze in Excel/BI tools
```

### Example 4: CLI Utilities

```bash
# Check database status and commit field population
python cli/check_database.py

# View sample commits with new fields
python cli/view_commit_samples.py

# Test API integration
python test_api_fields.py

# Update existing commits (after migration)
python cli/update_existing_commits.py
```

---

## CLI Utilities

The `cli/` package includes several commands for data extraction, metrics calculation, and analysis:

### Core Commands

**extract** - Extract Git repository history
```bash
python -m cli extract repositories.csv [--no-cleanup]
# Extracts commits, PRs, approvals from repositories
# Auto-calculates staff_metrics
# Clones repos to temporary directory (cleaned up unless --no-cleanup)
```

**import-staff** - Import staff details from Excel/CSV
```bash
python -m cli import-staff staff_data.xlsx
# Imports or updates staff master data
# Supports Excel (.xlsx) and CSV files
# Matches by staff_id for updates
```

**calculate-metrics** - Calculate pre-aggregated metrics (NEW!)
```bash
# Calculate all metrics (recommended after extract)
python -m cli calculate-metrics --all

# Calculate specific metrics
python -m cli calculate-metrics --staff
python -m cli calculate-metrics --repositories --teams
python -m cli calculate-metrics --commits --prs --daily

# Force recalculation (ignore timestamps)
python -m cli calculate-metrics --all --force
```

**What it does:**
- Creates/updates 6 pre-calculated metric tables
- 20-70x faster queries than real-time calculation
- Safe to run multiple times (upserts existing records)
- Shows detailed progress and summary

### Migration Scripts

**migrate_all_metrics_tables.py** - Initialize all metric tables
```bash
python migrate_all_metrics_tables.py
# Creates all 6 metric tables
# Calculates initial data
# Verifies table structure
# Shows detailed summary
```

**migrate_add_commit_details.py** - Add character/file type tracking
```bash
python cli/migrate_add_commit_details.py
# Adds new columns: chars_added, chars_deleted, file_types
# Safe to run multiple times (idempotent)
```

### Utility Scripts

**check_database.py** - Database status checker
```bash
python cli/check_database.py
# Shows repository counts, field population
# Auto-generates re-extraction CSV if needed
```

**update_existing_commits.py** - Batch update utility
```bash
python cli/update_existing_commits.py
# Re-extracts all repositories
# Updates existing commits with new fields
```

### Data Viewing

**view_commit_samples.py** - Sample data viewer
```bash
python cli/view_commit_samples.py
# Displays:
# - Sample commits with all fields
# - File type statistics
# - Character change distributions
```

### Testing

**test_api_fields.py** - API integration test
```bash
python test_api_fields.py
# Verifies:
# - Backend queries include new fields
# - JSON serialization works correctly
# - Sample output matches expected format
```

---

## Troubleshooting

### Frontend Issues

**Issue**: API connection refused
**Solution**: Ensure backend is running on port 8000
```bash
python start_backend.py
```

**Issue**: CORS errors
**Solution**: Check CORS configuration in `backend/main.py`

### Backend Issues

**Issue**: Database connection failed
**Solution**: Verify `.env` configuration and database accessibility

**Issue**: Import errors
**Solution**: Ensure all dependencies installed
```bash
pip install -r requirements.txt
```

### Mapping Issues

**Issue**: Auto-match finds no matches
**Solution**:
- Verify staff email addresses are populated
- Check author emails in commits
- Use manual mapping or bulk operations

**Issue**: Inactive staff appearing
**Solution**: Update staff_status to 'Inactive' in database

### Data Migration Issues ğŸ†•

**Issue**: New commit fields showing zeros or null
**Solution**:
```bash
# Run migration first
python cli/migrate_add_commit_details.py

# Then update existing commits
python cli/update_existing_commits.py
```

**Issue**: Some commits don't have character/file type data
**Reason**: This is normal for:
- Initial commits (no parent to diff against)
- Merge commits without clear diffs
- Binary file changes
**Solution**: Not an error - expected behavior

**Issue**: Update script fails on repository clone
**Solution**:
- Check network connectivity
- Verify repository URLs are accessible
- Ensure Git credentials are correct in .env

**Issue**: Character counts seem incorrect
**Solution**: Character counts exclude line markers (+/-) and file headers (+++/---), counting only actual content changes

---

## Performance

### Optimizations

1. **Backend**:
   - SQLAlchemy query optimization
   - Indexed database columns
   - Async FastAPI operations
   - Efficient JOIN queries

2. **Frontend**:
   - Vite for fast builds
   - React component memoization
   - Lazy loading for routes
   - Optimized re-renders

3. **Database**:
   - Indexes on frequently queried columns
   - Optimized GROUP BY queries
   - Connection pooling

### Benchmarks

- **Page Load**: < 1 second
- **API Response**: 50-200ms (typical)
- **Staff Analytics**: < 500ms (10K commits)
- **Productivity Query**: < 1s (all time data)
- **Frontend Build**: ~20 seconds

---

## Version History

### Version 3.0 (Current - React Edition)

**Major Features**:
- âœ… Complete React + FastAPI rewrite
- âœ… Modern responsive UI with Ant Design
- âœ… Staff Productivity Analytics page
- âœ… Enhanced Author-Staff Mapping
- âœ… Reverse mapping (staff â†’ author)
- âœ… Multi-select bulk operations
- âœ… Smart mapping suggestions
- âœ… Inactive staff exclusion
- âœ… Staff-based grouping in analytics
- âœ… "All" option in all filters
- âœ… Calendar heatmap visualization
- âœ… Real-time chart interactions
- âœ… Comprehensive CSV exports

**Technical Improvements**:
- Modern React 18 with hooks
- FastAPI with automatic OpenAPI docs
- SQLAlchemy 2.0 with type hints
- Pydantic v2 validation
- Vite for fast builds
- Component-based architecture
- RESTful API design

---

## License

This project is provided as-is for educational and analytical purposes.

---

## Quick Reference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMMAND REFERENCE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ # Installation                                              â”‚
â”‚ pip install -r requirements.txt                            â”‚
â”‚ cd frontend && npm install                                 â”‚
â”‚ cp .env.example .env                                       â”‚
â”‚                                                             â”‚
â”‚ # Data Extraction                                           â”‚
â”‚ python cli.py extract <csv_file>                          â”‚
â”‚ python cli.py import-staff <xlsx/csv>                     â”‚
â”‚                                                             â”‚
â”‚ # Start Application                                         â”‚
â”‚ python start_backend.py                # Backend           â”‚
â”‚ cd frontend && npm run dev             # Frontend          â”‚
â”‚                                                             â”‚
â”‚ # Access                                                    â”‚
â”‚ Frontend: http://localhost:5173                            â”‚
â”‚ Backend API: http://localhost:8000                         â”‚
â”‚ API Docs: http://localhost:8000/docs                       â”‚
â”‚                                                             â”‚
â”‚ # Production Build                                          â”‚
â”‚ cd frontend && npm run build                               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Version**: 3.0 (React Edition)
**Last Updated**: 2025
**Python**: 3.8+
**Node.js**: 16+
**Status**: Production Ready

**Key Technologies**: React 18 | FastAPI | Ant Design | SQLAlchemy | Pydantic | Vite | GitPython
